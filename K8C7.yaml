## WARNING: Generated by Kustomize @d44083b4b19593aea2bdf5fe4fcb1fa59b0cbb8d
apiVersion: v1
kind: Namespace
metadata:
  labels:
    app.kubernetes.io/env: demo
  name: camunda-bpm-demo
---
# apiVersion: v1
# data:
#   prometheus-jmx.yaml: |
#     ---
#     lowercaseOutputLabelNames: true
#     lowercaseOutputName: true
#     rules:
#     - pattern: 'Catalina<type=GlobalRequestProcessor, name=\"(\w+-\w+)-(\d+)\"><>(\w+):'
#       name: tomcat_$3_total
#       labels:
#         port: "$2"
#         protocol: "$1"
#       help: Tomcat global $3
#       type: COUNTER
#     - pattern: 'Catalina<j2eeType=Servlet, WebModule=//([-a-zA-Z0-9+&@#/%?=~_|!:.,;]*[-a-zA-Z0-9+&@#/%=~_|]), name=([-a-zA-Z0-9+/$%~_-|!.]*), J2EEApplication=none, J2EEServer=none><>(requestCount|maxTime|processingTime|errorCount):'
#       name: tomcat_servlet_$3_total
#       labels:
#         module: "$1"
#         servlet: "$2"
#       help: Tomcat servlet $3 total
#       type: COUNTER
#     - pattern: 'Catalina<type=ThreadPool, name="(\w+-\w+)-(\d+)"><>(currentThreadCount|currentThreadsBusy|keepAliveCount|pollerThreadCount|connectionCount):'
#       name: tomcat_threadpool_$3
#       labels:
#         port: "$2"
#         protocol: "$1"
#       help: Tomcat threadpool $3
#       type: GAUGE
#     - pattern: 'Catalina<type=Manager, host=([-a-zA-Z0-9+&@#/%?=~_|!:.,;]*[-a-zA-Z0-9+&@#/%=~_|]), context=([-a-zA-Z0-9+/$%~_-|!.]*)><>(processingTime|sessionCounter|rejectedSessions|expiredSessions):'
#       name: tomcat_session_$3_total
#       labels:
#         context: "$2"
#         host: "$1"
#       help: Tomcat session $3 total
#       type: COUNTER
# kind: ConfigMap
# metadata:
#   labels:
#     app.kubernetes.io/component: platform
#     app.kubernetes.io/env: demo
#   name: config-f876fcdt56
#   namespace: camunda-bpm-demo
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: platform
    app.kubernetes.io/env: demo
  name: camunda-bpm
  namespace: camunda-bpm-demo
spec:
  ports:
  - name: http
    port: 8283
    targetPort: http
  selector:
    app.kubernetes.io/component: platform
    app.kubernetes.io/env: demo
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: platform
    app.kubernetes.io/env: demo
  name: camunda-bpm
  namespace: camunda-bpm-demo
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/component: platform
      app.kubernetes.io/env: demo
  strategy:
    rollingUpdate:
      maxUnavailable: 1
  template:
    metadata:
      labels:
        app.kubernetes.io/app: camunda-bpm
        app.kubernetes.io/component: platform
        app.kubernetes.io/env: demo
    spec:
      containers:
      - image: gcr.io/iserveustaging/camunda-7-workflow-engine@sha256:d36205c21d8ce9cbaf1df67fd9e9d435c90b6a80026c8df931ea86f3d2326556 
        # livenessProbe:
        #   httpGet:
        #     path: /camunda_7
        #     port: http
        #   initialDelaySeconds: 60
        #   periodSeconds: 15
        name: camunda-bpm
        ports:
        - containerPort: 8283
          name: http
        - containerPort: 9404
          name: metrics
        # readinessProbe:
        #   httpGet:
        #     path: /camunda_7
        #     port: http
        #   initialDelaySeconds: 10
        #   periodSeconds: 15
        # resources:
        #   limits:
        #     memory: 512Mi
        #   requests:
        #     cpu: 300m
        #     memory: 512Mi
        securityContext:
          allowPrivilegeEscalation: false
          runAsUser: 1000
        volumeMounts:
        - mountPath: /etc/config/
          name: config
      volumes:
      - configMap:
          defaultMode: 484
          name: config-f876fcdt56
        name: config
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    certmanager.k8s.io/cluster-issuer: letsencrypt-prod-cluster
    # kubernetes.io/ingress.class: nginx
    kubernetes.io/tls-acme: "false"  # Ensure TLS is disabled
    nginx.ingress.kubernetes.io/affinity: "cookie"
    nginx.ingress.kubernetes.io/affinity-mode: persistent
  labels:
    app.kubernetes.io/component: platform
    app.kubernetes.io/env: demo
  name: camunda-bpm
  namespace: camunda-bpm-demo
spec:
  ingressClassName: "nginx"
  rules:
  - host: txnflow.txninfra.com
    http:
      paths:
      - path: /camunda_7
        pathType: Prefix
        backend:
          service:
            name: camunda-bpm
            port:
              name: http

  # tls:
  # - hosts:
  #   - camunda-bpm.example.com
  #   secretName: camunda-bpm.example.com-tls
---
# apiVersion: monitoring.coreos.com/v1
# kind: ServiceMonitor
# metadata:
#   labels:
#     app.kubernetes.io/component: platform
#     app.kubernetes.io/env: demo
#   name: jmx
#   namespace: camunda-bpm-demo
# spec:
#   endpoints:
#   - interval: 10s
#     port: metrics
#   selector:
#     matchLabels:
#       app.kubernetes.io/app: camunda-bpm